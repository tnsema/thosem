<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="thosem-logo.png">
    <link rel="icon" type="image/png" href="thosem-logo.png">
    <title>Budget Splitter | Thosem</title>
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background-color: #fff;
            color: #fff;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header section */
        h1 {
            color: #FFD700;
            margin-bottom: 30px;
            font-size: 2rem;
            text-align: center;
        }

        /* Input section */
        .input-section {
            background: #1a1a1a;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #333;
        }

        .amount-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        label {
            color: #FFD700;
            font-weight: 600;
            min-width: 150px;
        }

        .currency-input {
            display: flex;
            align-items: center;
            background: #000;
            border: 2px solid #FFD700;
            border-radius: 4px;
            padding: 10px;
            flex: 1;
        }

        .currency-prefix {
            color: #FFD700;
            font-weight: bold;
            margin-right: 5px;
        }

        input[type="number"] {
            background: transparent;
            border: none;
            color: #fff;
            font-size: 1.1rem;
            outline: none;
            width: 100%;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Preset buttons */
        .preset-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .preset-btn {
            background: #333;
            color: #FFD700;
            border: 2px solid #FFD700;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .preset-btn:hover,
        .preset-btn:focus {
            background: #FFD700;
            color: #000;
            outline: 2px solid #FFD700;
            outline-offset: 2px;
        }

        .preset-btn.active {
            background: #FFD700;
            color: #000;
        }

        /* Percentage inputs */
        .percentages {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .percentage-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .percentage-item label {
            font-size: 0.9rem;
            min-width: auto;
        }

        .percentage-item input {
            background: #000;
            border: 2px solid #FFD700;
            border-radius: 4px;
            padding: 10px;
            color: #fff;
            font-size: 1rem;
        }

        .error {
            color: #ff4444;
            font-size: 0.9rem;
            margin-top: 10px;
            padding: 10px;
            background: #330000;
            border-radius: 4px;
            border: 1px solid #ff4444;
        }

        /* Categories section */
        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .category {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #333;
        }

        .category h2 {
            color: #FFD700;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .category-amount {
            font-size: 1.3rem;
            color: #FFD700;
            margin-bottom: 20px;
            font-weight: 600;
        }

        /* Tasks section */
        .tasks {
            margin-top: 20px;
        }

        .task-item {
            background: #000;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .task-text {
            flex: 1;
            color: #fff;
            background: transparent;
            border: none;
            outline: none;
            padding: 5px;
        }

        .task-text:focus {
            background: #1a1a1a;
            border-radius: 4px;
        }

        .task-actions {
            display: flex;
            gap: 5px;
        }

        .task-btn {
            background: #333;
            color: #FFD700;
            border: 1px solid #FFD700;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .task-btn:hover,
        .task-btn:focus {
            background: #FFD700;
            color: #000;
            outline: 2px solid #FFD700;
            outline-offset: 2px;
        }

        .add-task-btn {
            background: #FFD700;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            width: 100%;
            transition: all 0.3s;
        }

        .add-task-btn:hover,
        .add-task-btn:focus {
            background: #FFC700;
            outline: 2px solid #FFD700;
            outline-offset: 2px;
        }

        /* Export section */
        .export-section {
            text-align: center;
            margin-top: 30px;
        }

        .export-btn {
            background: #FFD700;
            color: #000;
            border: none;
            padding: 15px 40px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s;
        }

        .export-btn:hover,
        .export-btn:focus {
            background: #FFC700;
            outline: 2px solid #FFD700;
            outline-offset: 2px;
            transform: translateY(-2px);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            .amount-input-group {
                flex-direction: column;
                align-items: flex-start;
            }

            label {
                min-width: auto;
            }

            .categories {
                grid-template-columns: 1fr;
            }

            .task-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .task-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Budget Splitter</h1>

        <!-- Amount input section -->
        <section class="input-section" aria-label="Budget input">
            <div class="amount-input-group">
                <label for="monthlyAmount">Monthly Amount:</label>
                <div class="currency-input">
                    <span class="currency-prefix" aria-label="Rands">R</span>
                    <input 
                        type="number" 
                        id="monthlyAmount" 
                        min="0" 
                        step="0.01"
                        placeholder="0.00"
                        aria-label="Enter monthly amount in Rands"
                    >
                </div>
            </div>

            <!-- Preset buttons -->
            <div class="preset-buttons" role="group" aria-label="Budget presets">
                <button class="preset-btn" data-preset="50/30/20" aria-label="Apply 50/30/20 budget preset">
                    50/30/20
                </button>
                <button class="preset-btn" data-preset="70/20/10" aria-label="Apply 70/20/10 budget preset">
                    70/20/10
                </button>
                <button class="preset-btn" data-preset="60/30/10" aria-label="Apply 60/30/10 budget preset">
                    60/30/10
                </button>
            </div>

            <!-- Percentage inputs -->
            <div class="percentages">
                <div class="percentage-item">
                    <label for="needsPercent">Needs (%):</label>
                    <input 
                        type="number" 
                        id="needsPercent" 
                        min="0" 
                        max="100" 
                        value="50"
                        aria-label="Percentage for needs"
                    >
                </div>
                <div class="percentage-item">
                    <label for="wantsPercent">Wants (%):</label>
                    <input 
                        type="number" 
                        id="wantsPercent" 
                        min="0" 
                        max="100" 
                        value="30"
                        aria-label="Percentage for wants"
                    >
                </div>
                <div class="percentage-item">
                    <label for="savingsPercent">Savings (%):</label>
                    <input 
                        type="number" 
                        id="savingsPercent" 
                        min="0" 
                        max="100" 
                        value="20"
                        aria-label="Percentage for savings"
                    >
                </div>
            </div>

            <!-- Error message -->
            <div id="percentageError" class="error" role="alert" style="display: none;"></div>
        </section>

        <!-- Categories section -->
        <section class="categories" aria-label="Budget categories">
            <!-- Needs category -->
            <article class="category" id="needsCategory">
                <h2>Needs</h2>
                <div class="category-amount" id="needsAmount" aria-live="polite">R 0.00</div>
                <div class="tasks" id="needsTasks" role="list" aria-label="Needs tasks"></div>
                <button class="add-task-btn" data-category="needs" aria-label="Add new task to Needs">
                    + Add Task
                </button>
            </article>

            <!-- Wants category -->
            <article class="category" id="wantsCategory">
                <h2>Wants</h2>
                <div class="category-amount" id="wantsAmount" aria-live="polite">R 0.00</div>
                <div class="tasks" id="wantsTasks" role="list" aria-label="Wants tasks"></div>
                <button class="add-task-btn" data-category="wants" aria-label="Add new task to Wants">
                    + Add Task
                </button>
            </article>

            <!-- Savings category -->
            <article class="category" id="savingsCategory">
                <h2>Savings</h2>
                <div class="category-amount" id="savingsAmount" aria-live="polite">R 0.00</div>
                <div class="tasks" id="savingsTasks" role="list" aria-label="Savings tasks"></div>
                <button class="add-task-btn" data-category="savings" aria-label="Add new task to Savings">
                    + Add Task
                </button>
            </article>
        </section>

        <!-- Export section -->
        <section class="export-section">
            <button class="export-btn" id="exportBtn" aria-label="Export budget summary">
                Export Summary
            </button>
        </section>
    </div>

    <script>
        // Default task recommendations for each category
        const defaultTasks = {
            needs: [
                'Rent/Shared room',
                'Groceries',
                'Transport',
                'Utilities',
                'Phone/Data',
                'Minimum debt payment'
            ],
            wants: [
                'Eating out',
                'Subscriptions',
                'Social outings',
                'Hobbies',
                'Minor tech'
            ],
            savings: [
                'Emergency fund',
                'Investments',
                'Retirement',
                'Side project fund',
                'Extra debt payment'
            ]
        };

        // Application state
        let state = {
            amount: 0,
            percentages: { needs: 50, wants: 30, savings: 20 },
            tasks: {
                needs: [...defaultTasks.needs],
                wants: [...defaultTasks.wants],
                savings: [...defaultTasks.savings]
            },
            lastPreset: '50/30/20'
        };

        // Load state from localStorage on page load
        function loadState() {
            const saved = localStorage.getItem('budgetSplitterState');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    state = { ...state, ...parsed };
                } catch (e) {
                    console.error('Error loading state:', e);
                }
            }
        }

        // Save state to localStorage
        function saveState() {
            localStorage.setItem('budgetSplitterState', JSON.stringify(state));
        }

        // Initialize application
        function init() {
            loadState();
            
            // Set input values from state
            document.getElementById('monthlyAmount').value = state.amount || '';
            document.getElementById('needsPercent').value = state.percentages.needs;
            document.getElementById('wantsPercent').value = state.percentages.wants;
            document.getElementById('savingsPercent').value = state.percentages.savings;

            // Highlight active preset
            updatePresetButtons();

            // Render tasks for all categories
            renderTasks('needs');
            renderTasks('wants');
            renderTasks('savings');

            // Calculate and display amounts
            calculate();

            // Event listeners
            document.getElementById('monthlyAmount').addEventListener('input', handleAmountChange);
            document.getElementById('needsPercent').addEventListener('input', handlePercentageChange);
            document.getElementById('wantsPercent').addEventListener('input', handlePercentageChange);
            document.getElementById('savingsPercent').addEventListener('input', handlePercentageChange);

            // Preset button listeners
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.addEventListener('click', handlePresetClick);
            });

            // Add task button listeners
            document.querySelectorAll('.add-task-btn').forEach(btn => {
                btn.addEventListener('click', handleAddTask);
            });

            // Export button listener
            document.getElementById('exportBtn').addEventListener('click', handleExport);
        }

        // Handle amount input change
        function handleAmountChange(e) {
            state.amount = parseFloat(e.target.value) || 0;
            calculate();
            saveState();
        }

        // Handle percentage input change
        function handlePercentageChange() {
            state.percentages.needs = parseFloat(document.getElementById('needsPercent').value) || 0;
            state.percentages.wants = parseFloat(document.getElementById('wantsPercent').value) || 0;
            state.percentages.savings = parseFloat(document.getElementById('savingsPercent').value) || 0;

            validatePercentages();
            calculate();
            updatePresetButtons();
            saveState();
        }

        // Validate that percentages sum to 100
        function validatePercentages() {
            const sum = state.percentages.needs + state.percentages.wants + state.percentages.savings;
            const errorEl = document.getElementById('percentageError');

            if (Math.abs(sum - 100) > 0.01) {
                errorEl.textContent = `Percentages must sum to 100% (current: ${sum.toFixed(1)}%)`;
                errorEl.style.display = 'block';
                return false;
            } else {
                errorEl.style.display = 'none';
                return true;
            }
        }

        // Calculate and display category amounts
        function calculate() {
            const amount = state.amount;
            
            const needsAmount = (amount * state.percentages.needs) / 100;
            const wantsAmount = (amount * state.percentages.wants) / 100;
            const savingsAmount = (amount * state.percentages.savings) / 100;

            document.getElementById('needsAmount').textContent = `R ${needsAmount.toFixed(2)}`;
            document.getElementById('wantsAmount').textContent = `R ${wantsAmount.toFixed(2)}`;
            document.getElementById('savingsAmount').textContent = `R ${savingsAmount.toFixed(2)}`;
        }

        // Handle preset button click
        function handlePresetClick(e) {
            const preset = e.target.dataset.preset;
            const [needs, wants, savings] = preset.split('/').map(Number);

            state.percentages = { needs, wants, savings };
            state.lastPreset = preset;

            document.getElementById('needsPercent').value = needs;
            document.getElementById('wantsPercent').value = wants;
            document.getElementById('savingsPercent').value = savings;

            validatePercentages();
            calculate();
            updatePresetButtons();
            saveState();
        }

        // Update active preset button styling
        function updatePresetButtons() {
            const currentPreset = `${state.percentages.needs}/${state.percentages.wants}/${state.percentages.savings}`;
            
            document.querySelectorAll('.preset-btn').forEach(btn => {
                if (btn.dataset.preset === currentPreset) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // Render tasks for a category
        function renderTasks(category) {
            const container = document.getElementById(`${category}Tasks`);
            container.innerHTML = '';

            state.tasks[category].forEach((task, index) => {
                const taskEl = createTaskElement(category, task, index);
                container.appendChild(taskEl);
            });
        }

        // Create a task element
        function createTaskElement(category, task, index) {
            const div = document.createElement('div');
            div.className = 'task-item';
            div.role = 'listitem';

            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'task-text';
            input.value = task;
            input.setAttribute('aria-label', `Task: ${task}`);
            input.addEventListener('change', (e) => {
                state.tasks[category][index] = e.target.value;
                saveState();
            });

            const actions = document.createElement('div');
            actions.className = 'task-actions';

            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'task-btn';
            deleteBtn.textContent = 'Delete';
            deleteBtn.setAttribute('aria-label', `Delete task: ${task}`);
            deleteBtn.addEventListener('click', () => {
                state.tasks[category].splice(index, 1);
                renderTasks(category);
                saveState();
            });

            actions.appendChild(deleteBtn);
            div.appendChild(input);
            div.appendChild(actions);

            return div;
        }

        // Handle add task button click
        function handleAddTask(e) {
            const category = e.target.dataset.category;
            state.tasks[category].push('New task');
            renderTasks(category);
            saveState();

            // Focus on newly added task
            const container = document.getElementById(`${category}Tasks`);
            const inputs = container.querySelectorAll('.task-text');
            if (inputs.length > 0) {
                inputs[inputs.length - 1].focus();
            }
        }

        // Handle export button click
        function handleExport() {
            // Generate plain text summary
            const summary = generateTextSummary();
            
            // Copy to clipboard
            navigator.clipboard.writeText(summary).then(() => {
                alert('Summary copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
            });

            // Download CSV
            downloadCSV();
        }

        // Generate plain text summary
        function generateTextSummary() {
            const needsAmount = (state.amount * state.percentages.needs) / 100;
            const wantsAmount = (state.amount * state.percentages.wants) / 100;
            const savingsAmount = (state.amount * state.percentages.savings) / 100;

            let summary = `BUDGET SUMMARY\n`;
            summary += `==============\n\n`;
            summary += `Monthly Amount: R ${state.amount.toFixed(2)}\n\n`;
            
            summary += `NEEDS (${state.percentages.needs}%): R ${needsAmount.toFixed(2)}\n`;
            state.tasks.needs.forEach(task => summary += `  - ${task}\n`);
            summary += `\n`;

            summary += `WANTS (${state.percentages.wants}%): R ${wantsAmount.toFixed(2)}\n`;
            state.tasks.wants.forEach(task => summary += `  - ${task}\n`);
            summary += `\n`;

            summary += `SAVINGS (${state.percentages.savings}%): R ${savingsAmount.toFixed(2)}\n`;
            state.tasks.savings.forEach(task => summary += `  - ${task}\n`);

            return summary;
        }

        // Download CSV file
        function downloadCSV() {
            const needsAmount = (state.amount * state.percentages.needs) / 100;
            const wantsAmount = (state.amount * state.percentages.wants) / 100;
            const savingsAmount = (state.amount * state.percentages.savings) / 100;

            let csv = 'Category,Percentage,Amount,Task\n';
            
            state.tasks.needs.forEach(task => {
                csv += `Needs,${state.percentages.needs}%,R ${needsAmount.toFixed(2)},"${task}"\n`;
            });

            state.tasks.wants.forEach(task => {
                csv += `Wants,${state.percentages.wants}%,R ${wantsAmount.toFixed(2)},"${task}"\n`;
            });

            state.tasks.savings.forEach(task => {
                csv += `Savings,${state.percentages.savings}%,R ${savingsAmount.toFixed(2)},"${task}"\n`;
            });

            // Create download link
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `budget-summary-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Initialize app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>

</html>
